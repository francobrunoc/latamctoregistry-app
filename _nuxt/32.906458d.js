(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{485:function(t,e,r){"use strict";r.r(e),r.d(e,"amplify_s3_album",(function(){return R}));var n=r(23),o=r(89),l=r(52),c=r(496),f=r(535),m=r(531),h=r(529),d=r(308),y=r(537),v=function(t,e,r,n){return new(r||(r=Promise))((function(o,l){function c(t){try{m(n.next(t))}catch(t){l(t)}}function f(t){try{m(n.throw(t))}catch(t){l(t)}}function m(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(c,f)}m((n=n.apply(t,e||[])).next())}))},w=function(t,body){var e,r,n,g,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return g={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function l(l){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(n=2&l[0]?r.return:l[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,l[1])).done)return n;switch(r=0,n&&(l=[2&l[0],n.value]),l[0]){case 0:case 1:n=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,r=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==l[0]&&2!==l[0])){o=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3])){o.label=l[1];break}if(6===l[0]&&o.label<n[1]){o.label=n[1],n=l;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(l);break}n[2]&&o.ops.pop(),o.trys.pop();continue}l=body.call(t,o)}catch(t){l=[6,t],r=0}finally{e=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}},k=function(){for(var s=0,i=0,t=arguments.length;i<t;i++)s+=arguments[i].length;var e=Array(s),r=0;for(i=0;i<t;i++)for(var a=arguments[i],n=0,o=a.length;n<o;n++,r++)e[r]=a[n];return e},x="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),I=new Uint8Array(16);function T(){if(!x)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return x(I)}var j=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function O(t){return"string"==typeof t&&j.test(t)}for(var A=[],i=0;i<256;++i)A.push((i+256).toString(16).substr(1));function E(t,e,r){var n=(t=t||{}).random||(t.rng||T)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){r=r||0;for(var i=0;i<16;++i)e[r+i]=n[i];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(A[t[e+0]]+A[t[e+1]]+A[t[e+2]]+A[t[e+3]]+"-"+A[t[e+4]]+A[t[e+5]]+"-"+A[t[e+6]]+A[t[e+7]]+"-"+A[t[e+8]]+A[t[e+9]]+"-"+A[t[e+10]]+A[t[e+11]]+A[t[e+12]]+A[t[e+13]]+A[t[e+14]]+A[t[e+15]]).toLowerCase();if(!O(r))throw TypeError("Stringified UUID is invalid");return r}(n)}var C=new o.a("S3Album"),R=function(){function t(t){var e=this;Object(n.k)(this,t),this.contentType="binary/octet-stream",this.level=f.a.Public,this.picker=!0,this.pickerText=m.a.PICKER_TEXT,this.albumItems=[],this.imgArr={},this.list=function(){return v(e,void 0,void 0,(function(){var t,e,path,r,track,n,data,o;return w(this,(function(l){switch(l.label){case 0:if(e=(t=this).path,path=void 0===e?"":e,r=t.level,track=t.track,n=t.identityId,C.debug("Album path: "+path),!d.a||"function"!=typeof d.a.list)throw new Error(h.n);l.label=1;case 1:return l.trys.push([1,3,,4]),[4,d.a.list(path,{level:r,track:track,identityId:n})];case 2:return data=l.sent(),this.marshal(data),[3,4];case 3:return o=l.sent(),C.warn(o),[3,4];case 4:return[2]}}))}))},this.marshal=function(t){t.forEach((function(t){var r=t.key.toLowerCase().split(".")[1];y.d.has(r)&&(!t.contentType||t.contentType&&"binary/octet-stream"===t.contentType)&&(t.contentType=e.getContentType(t))}));var r=t.filter((function(t){return t.contentType&&t.contentType.startsWith("image/")})),n=e.filter?e.filter(r):r;n=e.sort?e.sort(n):n,e.albumItems=n,C.debug("album items",e.albumItems),e.constructImgArray(e.albumItems)},this.constructImgArray=function(t){t.map((function(t){e.imgArr[""+t.key]=t.key}))},this.handlePick=function(t){return v(e,void 0,void 0,(function(){var e,r,n,path,o,track,l,c,f,m;return w(this,(function(h){switch(h.label){case 0:e=t.target.files[0],n=(r=this).path,path=void 0===n?"":n,o=r.level,track=r.track,l=r.fileToKey,c=path+Object(y.b)(e,l),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,Object(y.e)(c,e,o,track,e.type,C)];case 2:return h.sent(),[3,4];case 3:throw f=h.sent(),C.error(f),new Error(f);case 4:return Object.keys(this.imgArr).includes(c)?(this.albumItems=k(this.albumItems),this.imgArr[c]=c+"-"+E()):(m=k(this.albumItems,this.filter?this.filter([{key:c}]):[{key:c}]),this.albumItems=this.sort?this.sort(m):m),[2]}}))}))}}return t.prototype.getContentType=function(t){return Object(l.c)(t.key,"image/*")},t.prototype.componentWillLoad=function(){this.list()},t.prototype.render=function(){var t=this;return Object(n.i)("div",null,Object(n.i)("div",{class:"album-container"},Object(n.i)("div",{class:"grid-row"},this.albumItems.map((function(e){return Object(n.i)("div",{class:"grid-item",key:"key-"+e.key},Object(n.i)("amplify-s3-image",{key:t.imgArr[e.key],imgKey:e.key,level:t.level,path:t.path,identityId:t.identityId,track:t.track,handleOnError:t.handleOnError,handleOnLoad:t.handleOnLoad}),Object(n.i)("span",{class:"img-overlay"}))})))),this.picker&&Object(n.i)("amplify-picker",{pickerText:c.a.get(this.pickerText),inputHandler:function(e){return t.handlePick(e)},acceptValue:"image/*"}))},t}();R.style=":host{--overlay-bg-color:rgba(0, 0, 0, 0.15)}.album-container{-webkit-box-sizing:border-box;box-sizing:border-box;max-width:100%;margin:0 auto;padding:0 2rem}.grid-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:-1rem -1rem;padding-bottom:3rem}.grid-item{position:relative;-ms-flex:1 0 22rem;flex:1 0 22rem;-ms-flex-positive:1;flex-grow:1;margin:1rem;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}amplify-s3-image{--width:22rem;--height:20rem;border-radius:5px;-o-object-fit:cover;object-fit:cover}.img-overlay{display:none;width:100%;height:21rem;position:absolute;top:0;left:0;background-color:var(--overlay-bg-color)}.grid-item:hover .img-overlay{display:block}"}}]);